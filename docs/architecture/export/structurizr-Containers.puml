@startuml
title <size:24>990prep - Container Diagram (Level 2)</size>\n<size:24>Shows the containers that make up 990prep</size>

set separator none
top to bottom direction
skinparam ranksep 60
skinparam nodesep 30
hide stereotype

<style>
  root {
    BackgroundColor: #ffffff;
    FontColor: #444444;
  }
  // Element,Container,API
  .Element-RWxlbWVudCxDb250YWluZXIsQVBJ {
    BackgroundColor: #438dd5;
    LineColor: #2e6295;
    LineStyle: 0;
    LineThickness: 2;
    FontColor: #ffffff;
    FontSize: 24;
    HorizontalAlignment: center;
    Shadowing: 0;
    MaximumWidth: 450;
  }
  // Element,Container,Web Browser
  .Element-RWxlbWVudCxDb250YWluZXIsV2ViIEJyb3dzZXI= {
    BackgroundColor: #438dd5;
    LineColor: #2e6295;
    LineStyle: 0;
    LineThickness: 2;
    FontColor: #ffffff;
    FontSize: 24;
    HorizontalAlignment: center;
    Shadowing: 0;
    MaximumWidth: 450;
  }
  // Element,Person,User
  .Element-RWxlbWVudCxQZXJzb24sVXNlcg== {
    BackgroundColor: #08427b;
    LineColor: #052e56;
    LineStyle: 0;
    LineThickness: 2;
    FontColor: #ffffff;
    FontSize: 24;
    HorizontalAlignment: center;
    Shadowing: 0;
    MaximumWidth: 450;
  }
  // Element,Software System,External System
  .Element-RWxlbWVudCxTb2Z0d2FyZSBTeXN0ZW0sRXh0ZXJuYWwgU3lzdGVt {
    BackgroundColor: #999999;
    LineColor: #6b6b6b;
    LineStyle: 0;
    LineThickness: 2;
    RoundCorner: 20;
    FontColor: #ffffff;
    FontSize: 24;
    HorizontalAlignment: center;
    Shadowing: 0;
    MaximumWidth: 450;
  }
  // Relationship
  .Relationship-UmVsYXRpb25zaGlw {
    LineThickness: 2;
    LineStyle: 10-10;
    LineColor: #444444;
    FontColor: #444444;
    FontSize: 24;
  }
  // 990prep
  .Boundary-OTkwcHJlcA== {
    BackgroundColor: #ffffff;
    LineColor: #0b4884;
    LineStyle: 0;
    LineThickness: 2;
    FontColor: #1168bd;
    FontSize: 24;
    HorizontalAlignment: center;
    Shadowing: 0;
  }
</style>

person "==Nonprofit Staff\n<size:16>[Person]</size>\n\nExecutive directors and finance staff at nonprofit organizations who need to file Form 990" <<Element-RWxlbWVudCxQZXJzb24sVXNlcg==>> as NonprofitStaff
person "==Accountant/CPA\n<size:16>[Person]</size>\n\nTax professionals who prepare Form 990 returns for nonprofit clients" <<Element-RWxlbWVudCxQZXJzb24sVXNlcg==>> as AccountantCPA
rectangle "==Stripe\n<size:16>[Software System]</size>\n\nPayment processing platform for subscription billing" <<Element-RWxlbWVudCxTb2Z0d2FyZSBTeXN0ZW0sRXh0ZXJuYWwgU3lzdGVt>> as Stripe
rectangle "==Supabase\n<size:16>[Software System]</size>\n\nBackend-as-a-Service providing PostgreSQL database and authentication" <<Element-RWxlbWVudCxTb2Z0d2FyZSBTeXN0ZW0sRXh0ZXJuYWwgU3lzdGVt>> as Supabase
rectangle "==PostHog\n<size:16>[Software System]</size>\n\nProduct analytics and feature flag platform" <<Element-RWxlbWVudCxTb2Z0d2FyZSBTeXN0ZW0sRXh0ZXJuYWwgU3lzdGVt>> as PostHog
rectangle "==TikTok Ads\n<size:16>[Software System]</size>\n\nAdvertising platform for conversion tracking" <<Element-RWxlbWVudCxTb2Z0d2FyZSBTeXN0ZW0sRXh0ZXJuYWwgU3lzdGVt>> as TikTokAds

rectangle "990prep\n<size:16>[Software System]</size>" <<Boundary-OTkwcHJlcA==>> {
  rectangle "==Web Application\n<size:16>[Container: SvelteKit / Node.js]</size>\n\nProvides Form 990 preparation UI, data entry wizards, and document management" <<Element-RWxlbWVudCxDb250YWluZXIsV2ViIEJyb3dzZXI=>> as 990prep.WebApplication
  hexagon "==API Layer\n<size:16>[Container: SvelteKit Server / Node.js]</size>\n\nHandles business logic, form validation, and orchestrates external service calls" <<Element-RWxlbWVudCxDb250YWluZXIsQVBJ>> as 990prep.APILayer
}

990prep.APILayer --> Supabase <<Relationship-UmVsYXRpb25zaGlw>> : "Reads/writes organization data, form drafts, user accounts\n<size:16>[HTTPS/PostgreSQL]</size>"
NonprofitStaff --> 990prep.WebApplication <<Relationship-UmVsYXRpb25zaGlw>> : "Uses\n<size:16>[HTTPS]</size>"
AccountantCPA --> 990prep.WebApplication <<Relationship-UmVsYXRpb25zaGlw>> : "Uses\n<size:16>[HTTPS]</size>"
990prep.WebApplication --> 990prep.APILayer <<Relationship-UmVsYXRpb25zaGlw>> : "Makes API calls\n<size:16>[HTTPS/JSON]</size>"
990prep.APILayer --> Stripe <<Relationship-UmVsYXRpb25zaGlw>> : "Creates checkout sessions, manages subscriptions\n<size:16>[Stripe API]</size>"
990prep.APILayer --> Supabase <<Relationship-UmVsYXRpb25zaGlw>> : "CRUD operations on forms, orgs, users\n<size:16>[Supabase Client]</size>"
990prep.WebApplication --> PostHog <<Relationship-UmVsYXRpb25zaGlw>> : "Tracks user behavior\n<size:16>[PostHog JS SDK]</size>"
990prep.WebApplication --> TikTokAds <<Relationship-UmVsYXRpb25zaGlw>> : "Fires conversion events\n<size:16>[TikTok Pixel]</size>"

@enduml